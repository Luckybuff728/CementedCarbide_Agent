# TopMat Agent - ç¡¬è´¨åˆé‡‘æ¶‚å±‚æ™ºèƒ½ç ”å‘åŠ©æ‰‹

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

TopMat Agent æ˜¯ä¸€ä¸ªåŸºäº **LangGraph** çš„å¯¹è¯å¼å¤š Agent æ™ºèƒ½ç³»ç»Ÿï¼Œä¸“æ³¨äºç¡¬è´¨åˆé‡‘æ¶‚å±‚ï¼ˆAlTiN ç­‰ï¼‰çš„ç ”å‘ä¼˜åŒ–ã€‚é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œä¸ºææ–™ç ”å‘æä¾›å‚æ•°éªŒè¯ã€æ€§èƒ½é¢„æµ‹ã€æ–¹æ¡ˆä¼˜åŒ–ã€å®éªŒç®¡ç†ç­‰å…¨æµç¨‹æ”¯æŒã€‚

### âœ¨ æ ¸å¿ƒç‰¹ç‚¹

- ğŸ¤– **å¯¹è¯å¼äº¤äº’**: è‡ªç„¶è¯­è¨€é©±åŠ¨ï¼Œæ™ºèƒ½ç†è§£ç”¨æˆ·æ„å›¾
- ğŸ§  **å¤š Agent åä½œ**: éªŒè¯/åˆ†æ/ä¼˜åŒ–/å®éªŒä¸“å®¶æ™ºèƒ½è·¯ç”±
- ğŸ’­ **æ€è€ƒè¿‡ç¨‹å¯è§**: å±•ç¤º AI æ¨ç†è¿‡ç¨‹ï¼Œæå‡å¯è§£é‡Šæ€§
- ğŸ“Š **å®æ—¶æµå¼è¾“å‡º**: WebSocket åŒå‘é€šä¿¡ï¼Œæ‰“å­—æœºæ•ˆæœ
- ğŸ”¬ **ä¸“ä¸šå·¥å…·é›†æˆ**: TopPhi æ¨¡æ‹Ÿã€ML é¢„æµ‹ã€å†å²æ¡ˆä¾‹æ£€ç´¢
- ğŸ¨ **ç°ä»£åŒ–ç•Œé¢**: Vue 3 + Element Plusï¼Œç®€æ´ä¸“ä¸š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 0. è·å–ä»£ç 

```bash
git clone http://192.168.6.104:3000/TopMaterial_Agent/CementedCarbide_Agent/src/branch/TangBin.git
```

### æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**ä¸€é”®å¯åŠ¨ï¼Œæ— éœ€å®‰è£…ä¾èµ–ï¼**

```bash
# 1. é…ç½®APIå¯†é’¥
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ DASHSCOPE_API_KEY

# 2. æ„å»ºå¹¶å¯åŠ¨
docker-compose build
#æˆ–å•ç‹¬æ„å»º
docker build --file .\Dockerfile.frontend -t topmat_agent-frontend .
docker build --file .\Dockerfile.backend -t topmat_agent-backend .
# å¯åŠ¨
docker-compose up -d

# 3. è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost
# APIæ–‡æ¡£: http://localhost/api/docs
```

ğŸ“– è¯¦ç»†è¯´æ˜: 
- [Docker éƒ¨ç½²æŒ‡å—](DOCKER_DEPLOY.md)
- [VTKæ•°æ®éƒ¨ç½²æ–¹æ¡ˆ](docs/VTKæ•°æ®éƒ¨ç½²æ–¹æ¡ˆ.md) - åŒ…å«VTKå¯è§†åŒ–æ•°æ®çš„éƒ¨ç½²é€‰é¡¹

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘éƒ¨ç½²

#### ç¯å¢ƒè¦æ±‚
- Python 3.11+
- Node.js 18+
- é˜¿é‡Œäº‘ç™¾ç‚¼APIå¯†é’¥

#### å®‰è£…æ­¥éª¤

**1. å®‰è£…Pythonä¾èµ–**
```bash
pip install -r requirements.txt
```

**2. é…ç½®ç¯å¢ƒå˜é‡**
```bash
# å¤åˆ¶å¹¶ç¼–è¾‘åç«¯é…ç½®
copy .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é˜¿é‡Œäº‘ç™¾ç‚¼APIå¯†é’¥

# å¤åˆ¶å‰ç«¯é…ç½®ï¼ˆå¯é€‰ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼‰
cd frontend
copy .env.example .env
cd ..
```

**3. å®‰è£…å‰ç«¯ä¾èµ–**
```bash
cd frontend
npm install
cd ..
```

**4. å¯åŠ¨åç«¯ï¼ˆç»ˆç«¯1ï¼‰**
```bash
# ç›´æ¥å¯åŠ¨ï¼ˆå¼€å‘æ¨¡å¼ï¼Œæ”¯æŒçƒ­é‡è½½ï¼‰
python run.py

# æˆ–ç”Ÿäº§æ¨¡å¼ï¼ˆç¦ç”¨çƒ­é‡è½½ï¼‰
python run.py --no-reload
```

**5. å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯2ï¼‰**
```bash
cd frontend
npm run dev
```

**6. è®¿é—®åº”ç”¨**
- ğŸŒ å‰ç«¯ç•Œé¢: http://localhost:5173
- ğŸ“š APIæ–‡æ¡£: http://localhost:8000/docs
- ğŸ’š å¥åº·æ£€æŸ¥: http://localhost:8000/health

### é…ç½®è¯´æ˜

#### åç«¯é…ç½® (`.env`)
| é…ç½®é¡¹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| DASHSCOPE_API_KEY | âœ“ | - | é˜¿é‡Œäº‘ç™¾ç‚¼APIå¯†é’¥ |
| DASHSCOPE_MODEL_NAME | âœ— | qwen-plus | LLMæ¨¡å‹åç§° |
| SERVER_HOST | âœ— | 0.0.0.0 | æœåŠ¡å™¨ç›‘å¬åœ°å€ |
| SERVER_PORT | âœ— | 8000 | æœåŠ¡å™¨ç«¯å£ |

#### å‰ç«¯é…ç½® (å¯é€‰)
å‰ç«¯ä¼šè‡ªåŠ¨ä½¿ç”¨ `http://localhost:8000` ä½œä¸ºåç«¯åœ°å€ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œå¯åœ¨ `frontend/.env` ä¸­é…ç½®ã€‚

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å·¥ä½œæµç¨‹

1. **è¾“å…¥å‚æ•°** â†’ å¡«å†™æ¶‚å±‚æˆåˆ†ã€å·¥è‰ºå‚æ•°ã€ç»“æ„è®¾è®¡
2. **æ™ºèƒ½åˆ†æ** â†’ TopPhiæ¨¡æ‹Ÿ + MLé¢„æµ‹ + å†å²æ•°æ®å¯¹æ¯”
3. **æ€§èƒ½é¢„æµ‹** â†’ ç¡¬åº¦ã€ç»“åˆåŠ›ç­‰æ€§èƒ½æŒ‡æ ‡é¢„æµ‹
4. **ä¼˜åŒ–å»ºè®®** â†’ æˆåˆ†/ç»“æ„/å·¥è‰ºä¸‰ä¸ªç»´åº¦çš„ä¼˜åŒ–æ–¹æ¡ˆ
5. **å®éªŒéªŒè¯** â†’ é€‰æ‹©æ–¹æ¡ˆï¼Œè¾“å…¥å®éªŒç»“æœ
6. **è¿­ä»£ä¼˜åŒ–** â†’ ç³»ç»Ÿåˆ†æç»“æœï¼Œæ™ºèƒ½å†³ç­–ä¸‹ä¸€æ­¥

### ç•Œé¢ç‰¹æ€§

- ğŸ’¬ **æµå¼è¾“å‡º**: å®æ—¶æ˜¾ç¤ºAIåˆ†æè¿‡ç¨‹ï¼Œæ‰“å­—æœºæ•ˆæœ
- ğŸ“Š **åˆ†æ­¥å±•ç¤º**: å„èŠ‚ç‚¹ç»“æœç‹¬ç«‹å¡ç‰‡æ˜¾ç¤º
- ğŸ¨ **Markdownæ¸²æŸ“**: æ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ã€ä»£ç å—ç­‰
- ğŸ“ˆ **3Då¯è§†åŒ–**: TopPhiæ¨¡æ‹Ÿç»“æœVTKå¯è§†åŒ–
- ğŸ“œ **å†å²æŸ¥çœ‹**: æŸ¥çœ‹å†å²è¿­ä»£è®°å½•

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æµè§ˆå™¨    â”‚ WebSocketâ”‚  FastAPI   â”‚  â”‚
â”‚  â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Backend   â”‚  â”‚
â”‚  â”‚ Vue 3    â”‚   HTTP   â”‚            â”‚  â”‚
â”‚  â”‚ :5173    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  :8000     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚         â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                        â”‚ LangGraph  â”‚  â”‚
â”‚                        â”‚  Workflow  â”‚  â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- âœ… å‰åç«¯åˆ†ç¦»ï¼Œç‹¬ç«‹å¼€å‘éƒ¨ç½²
- âœ… WebSocketå®æ—¶åŒå‘é€šä¿¡
- âœ… LangGraphç®¡ç†å¤æ‚å·¥ä½œæµ
- âœ… é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†

### é¡¹ç›®ç»“æ„
```
TopMat_Agent/
â”œâ”€â”€ frontend/                      # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/            # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/              # èŠå¤©é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ params/            # å‚æ•°è¾“å…¥
â”‚   â”‚   â”‚   â””â”€â”€ results/           # ç»“æœå±•ç¤º
â”‚   â”‚   â”œâ”€â”€ composables/           # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ useMultiAgent.js   # å¤š Agent é€šä¿¡
â”‚   â”‚   â”‚   â””â”€â”€ useWebSocket.js    # WebSocket å°è£…
â”‚   â”‚   â””â”€â”€ views/                 # é¡µé¢è§†å›¾
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ src/                           # åç«¯æºç 
â”‚   â”œâ”€â”€ agents/                    # å¤š Agent ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ graph.py               # å¯¹è¯å¼å›¾æ„å»º
â”‚   â”‚   â”œâ”€â”€ state.py               # çŠ¶æ€å®šä¹‰ (TypedDict)
â”‚   â”‚   â”œâ”€â”€ content_extractor.py   # ç»“æ„åŒ–å†…å®¹æå–
â”‚   â”‚   â”œâ”€â”€ middleware/            # Agent ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py          # ä¸­é—´ä»¶é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ context_middleware.py  # ä¸Šä¸‹æ–‡æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ prompts/               # Agent æç¤ºè¯
â”‚   â”‚   â”‚   â”œâ”€â”€ validator.py       # å‚æ•°éªŒè¯ä¸“å®¶
â”‚   â”‚   â”‚   â”œâ”€â”€ analyst.py         # æ€§èƒ½åˆ†æä¸“å®¶
â”‚   â”‚   â”‚   â”œâ”€â”€ optimizer.py       # ä¼˜åŒ–å»ºè®®ä¸“å®¶
â”‚   â”‚   â”‚   â””â”€â”€ experimenter.py    # å®éªŒæ–¹æ¡ˆä¸“å®¶
â”‚   â”‚   â””â”€â”€ tools/                 # Agent å·¥å…·
â”‚   â”‚       â”œâ”€â”€ state_tools.py     # çŠ¶æ€æ›´æ–°å·¥å…· (Command)
â”‚   â”‚       â”œâ”€â”€ validation_tools.py
â”‚   â”‚       â”œâ”€â”€ analysis_tools.py
â”‚   â”‚       â””â”€â”€ experiment_tools.py
â”‚   â”œâ”€â”€ api/                       # FastAPI åç«¯
â”‚   â”‚   â”œâ”€â”€ main.py                # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ routes/                # REST API
â”‚   â”‚   â””â”€â”€ websocket/             # WebSocket
â”‚   â”‚       â”œâ”€â”€ routes.py          # è·¯ç”±æ³¨å†Œ
â”‚   â”‚       â”œâ”€â”€ chat_handlers.py   # å¯¹è¯å¤„ç†
â”‚   â”‚       â””â”€â”€ manager.py         # è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ llm/                       # LLM æœåŠ¡
â”‚   â”‚   â””â”€â”€ llm_service.py         # Qwen + æ€è€ƒæ¨¡å¼
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ validation_service.py
â”‚   â”‚   â”œâ”€â”€ topphi_service.py
â”‚   â”‚   â”œâ”€â”€ ml_prediction_service.py
â”‚   â”‚   â””â”€â”€ optimization_service.py
â”‚   â””â”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”œâ”€â”€ .env                           # ç¯å¢ƒå˜é‡
â”œâ”€â”€ run.py                         # å¯åŠ¨è„šæœ¬
â””â”€â”€ requirements.txt
```

### æŠ€æœ¯æ ˆ

**å‰ç«¯**
- Vue 3 + Composition API
- Element Plus + Naive UI
- Vite
- VTK.js (3Då¯è§†åŒ–)
- Pinia (çŠ¶æ€ç®¡ç†)

**åç«¯**
- FastAPI
- LangGraph
- é˜¿é‡Œäº‘ç™¾ç‚¼ (Qwen)
- Uvicorn

**å¼€å‘å·¥å…·**
- çƒ­é‡è½½æ”¯æŒ
- ç¯å¢ƒå˜é‡é…ç½®
- ç»Ÿä¸€é…ç½®ç®¡ç†

## ğŸ”§ å¤š Agent æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å¯¹è¯ç•Œé¢                            â”‚
â”‚                    (Vue 3 + WebSocket)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ™ºèƒ½è·¯ç”± (Router)                       â”‚
â”‚              æ ¹æ®ç”¨æˆ·æ„å›¾åˆ†å‘åˆ°åˆé€‚çš„ä¸“å®¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚           â”‚           â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚Validatorâ”‚ â”‚ Analyst â”‚ â”‚Optimizerâ”‚ â”‚Experimenterâ”‚
   â”‚å‚æ•°éªŒè¯  â”‚ â”‚æ€§èƒ½é¢„æµ‹  â”‚ â”‚æ–¹æ¡ˆä¼˜åŒ–  â”‚ â”‚å®éªŒç®¡ç†   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚           â”‚           â”‚           â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚              Tools (å·¥å…·å±‚)                  â”‚
   â”‚  éªŒè¯å·¥å…· | åˆ†æå·¥å…· | ä¼˜åŒ–å·¥å…· | å®éªŒå·¥å…·   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚            Services (ä¸šåŠ¡æœåŠ¡å±‚)             â”‚
   â”‚  ValidationService | TopPhiService | ...    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent è§’è‰²è¯´æ˜

| Agent | èŒè´£ | å·¥å…· |
|-------|------|------|
| **Router** | æ™ºèƒ½è·¯ç”±ï¼Œç†è§£ç”¨æˆ·æ„å›¾ | - |
| **Assistant** | é€šç”¨å¯¹è¯ï¼Œè§£é‡Šæ€§é—®é¢˜ï¼ˆå¸¦æ€è€ƒæ¨¡å¼ï¼‰ | - |
| **Validator** | å‚æ•°éªŒè¯ï¼Œæˆåˆ†/å·¥è‰ºåˆç†æ€§æ£€æŸ¥ | æˆåˆ†éªŒè¯ã€å·¥è‰ºéªŒè¯ã€å½’ä¸€åŒ– |
| **Analyst** | æ€§èƒ½é¢„æµ‹ï¼Œè°ƒç”¨æ¨¡æ‹Ÿå’Œ ML å·¥å…· | TopPhi æ¨¡æ‹Ÿã€ML é¢„æµ‹ã€å†å²æ¡ˆä¾‹ |
| **Optimizer** | ä¼˜åŒ–å»ºè®®ï¼Œç”Ÿæˆ P1/P2/P3 æ–¹æ¡ˆ | - (Agent è‡ªä¸»ç”Ÿæˆ) |
| **Experimenter** | å®éªŒç®¡ç†ï¼Œå·¥å•ç”Ÿæˆå’Œç»“æœåˆ†æ | æ€§èƒ½å¯¹æ¯”ã€æ•°æ®é‡‡é›† |

### å¯¹è¯æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æ¶ˆæ¯] --> B[Router è·¯ç”±]
    B --> C{æ„å›¾åˆ¤æ–­}
    C -->|è§£é‡Š/é—®ç­”| D[Assistant<br/>ğŸ’­ æ€è€ƒæ¨¡å¼]
    C -->|éªŒè¯å‚æ•°| E[Validator]
    C -->|é¢„æµ‹æ€§èƒ½| F[Analyst]
    C -->|ä¼˜åŒ–æ–¹æ¡ˆ| G[Optimizer]
    C -->|å®éªŒç®¡ç†| H[Experimenter]
    D --> I[æµå¼å“åº”]
    E --> I
    F --> I
    G --> I
    H --> I
```

### WebSocket æ¶ˆæ¯åè®®

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|---------|------|------|
| `chat_message` | å‰â†’å | ç”¨æˆ·å‘é€æ¶ˆæ¯ |
| `chat_start` | åâ†’å‰ | å¼€å§‹å¤„ç† |
| `agent_start` | åâ†’å‰ | Agent å¼€å§‹å·¥ä½œ |
| `thinking_token` | åâ†’å‰ | æ€è€ƒè¿‡ç¨‹æµå¼è¾“å‡º |
| `chat_token` | åâ†’å‰ | å›å¤å†…å®¹æµå¼è¾“å‡º |
| `tool_start/end` | åâ†’å‰ | å·¥å…·è°ƒç”¨çŠ¶æ€ |
| `tool_result` | åâ†’å‰ | å·¥å…·è¿”å›ç»“æœ |
| `chat_complete` | åâ†’å‰ | å¤„ç†å®Œæˆ |

### å…³é”®æŠ€æœ¯ç‰¹æ€§

**1. æ€è€ƒæ¨¡å¼ (Thinking Mode)**

Assistant ä½¿ç”¨ Qwen çš„ `enable_thinking` æ¨¡å¼ï¼Œå±•ç¤ºæ¨ç†è¿‡ç¨‹ï¼š

```python
thinking_llm = QwenChatOpenAI(
    model="qwen-plus",
    enable_thinking=True  # å¯ç”¨æ€è€ƒæ¨¡å¼
)
```

**2. ReAct Agent æ¨¡å¼**

ä½¿ç”¨ LangGraph çš„ `create_react_agent` åˆ›å»ºå·¥å…·è°ƒç”¨ Agentï¼š

```python
expert_agent = create_react_agent(
    model=llm,
    tools=tools,
    state_schema=CoatingState,
    prompt=expert_prompt,
)
```

**3. æµå¼äº‹ä»¶å¤„ç†**

é€šè¿‡ `astream_events` æ•è·æ‰€æœ‰äº‹ä»¶å¹¶å®æ—¶å‘é€ï¼š

```python
async for event in graph.astream_events(state, config):
    if event["event"] == "on_chat_model_stream":
        yield {"type": "token", "content": chunk.content}
```

### API æ–‡æ¡£

å¯åŠ¨åè®¿é—® http://localhost:8000/docs æŸ¥çœ‹ Swagger æ–‡æ¡£ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

**1. å¯¹è¯å¼äº¤äº’**
- è‡ªç„¶è¯­è¨€è¾“å…¥ï¼Œæ— éœ€å¤æ‚è¡¨å•
- æ™ºèƒ½ç†è§£æ„å›¾ï¼Œè‡ªåŠ¨è·¯ç”±åˆ°åˆé€‚ä¸“å®¶
- æ”¯æŒè¿½é—®å’Œè§£é‡Šæ€§é—®é¢˜

**2. å‚æ•°éªŒè¯**
- æ¶‚å±‚æˆåˆ†åˆç†æ€§æ£€æŸ¥
- å·¥è‰ºå‚æ•°èŒƒå›´éªŒè¯
- è‡ªåŠ¨å½’ä¸€åŒ–å¤„ç†

**3. æ€§èƒ½é¢„æµ‹**
- TopPhi ç¬¬ä¸€æ€§åŸç†æ¨¡æ‹Ÿ
- ML æ¨¡å‹é¢„æµ‹ï¼ˆç¡¬åº¦ã€ç»“åˆåŠ›ç­‰ï¼‰
- å†å²ç›¸ä¼¼æ¡ˆä¾‹æ£€ç´¢

**4. æ–¹æ¡ˆä¼˜åŒ–**
- **P1 æˆåˆ†ä¼˜åŒ–**: Al/Ti æ¯”ä¾‹ã€å¾®é‡å…ƒç´ 
- **P2 ç»“æ„ä¼˜åŒ–**: å¤šå±‚/æ¢¯åº¦/çº³ç±³å¤åˆ
- **P3 å·¥è‰ºä¼˜åŒ–**: æ¸©åº¦/æ°”å‹/åå‹è°ƒæ•´

**5. å®éªŒç®¡ç†**
- è‡ªåŠ¨ç”Ÿæˆå®éªŒå·¥å•
- å®éªŒç»“æœåˆ†æ
- è¿­ä»£ä¼˜åŒ–å»ºè®®

## ğŸ› å¸¸è§é—®é¢˜

**Q: åç«¯å¯åŠ¨å¤±è´¥ï¼Ÿ**  
A: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DASHSCOPE_API_KEY` æ˜¯å¦æ­£ç¡®é…ç½®ã€‚

**Q: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Ÿ**  
A: ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆhttp://localhost:8000ï¼‰ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®ã€‚

**Q: å¦‚ä½•ä¿®æ”¹æœåŠ¡ç«¯å£ï¼Ÿ**  
A: ç¼–è¾‘ `.env` æ–‡ä»¶ä¸­çš„ `SERVER_PORT` é…ç½®é¡¹ã€‚

**Q: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ**  
A: åç«¯æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå‰ç«¯é—®é¢˜æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

